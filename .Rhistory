comp.attr$year %in% selected.years,]
# Subsetting attribute matrix
ord.att <- comp.attr[comp.attr$water %in% selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fertilization %in% selected.fert &
comp.attr$year %in% selected.years,]
# Checking that these datasets are the same size
expect_true(nrow(ord.att) == nrow(ord.mat))
# Filtering species
totalcov = sum(ord.mat)
toselect = waps.specs$specname[waps.specs$group %in% c("annual", "natives", "waps")]
ord.mat = ord.mat %>% select(toselect)
cat("Fraction of total cover contained in subset =", sum(ord.mat) / totalcov)
# A number of rows have  no recorded live plants (mostly dry treatments?)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
sumtable = left_join(ord.att, bind_cols(comp.attr,group_percents)) %>%
group_by(plot, year, sp.trt) %>%
select(annuals, natives, waps) %>%
mutate(total = sum(annuals, natives, waps)) %>%
group_by(year, sp.trt) %>%
summarise(annprop = mean(annuals / total),
natprop = mean(natives / total),
wapsprop = mean(waps / total),
annsem = sd(annuals / total) / sqrt(n()),
natsem = sd(natives / total) / sqrt(n()),
wapssem = sd(waps / total) / sqrt(n()))
sumtable %>%
ggplot(aes(x = year)) +
geom_line(aes(y = annprop), color = "red") +
geom_line(aes(y = natprop), color = "green") +
geom_line(aes(y = wapsprop), color = "blue") +
geom_errorbar(aes(ymin = annprop - annsem,
ymax = annprop + annsem),
color = "red",
width = .1) +
geom_errorbar(aes(ymin = natprop - natsem,
ymax = natprop + natsem),
color = "green",
width = .1) +
geom_errorbar(aes(ymin = wapsprop - wapssem,
ymax = wapsprop + wapssem),
color = "blue",
width = .1) +
xlab("Year") +
ylab("Proportional Abundance")+
facet_wrap(~sp.trt, nrow = 4)
ggsave("../figures/ProportionalAbundances.pdf", width = 10, height = 6)
# Constructing distance matrix and running NMDS
distmat <- vegdist(decostand(ord.mat, "total"), method = "bray")
WAPS.mds <- metaMDS(distmat, try = 1, trymax = 5, trace = F, autotransform = TRUE)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
# Plotting figure
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(color = as.factor(year))) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2)))
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(color = as.factor(sp.trt)), size = 2) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}') +
transition_time(year) +
ease_aes('linear')
animate(p, detail = 40, fps = 10)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(color = as.factor(sp.trt)), size = 2) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}') +
transition_time(year) +
ease_aes('linear') +
theme_void()
animate(p, detail = 10, fps = 10)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(color = as.factor(sp.trt)), size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}') +
transition_time(year) +
ease_aes('linear') +
theme_void()
animate(p, detail = 10, fps = 10)
?scale_color_discrete
MDS_xy$sp.trt
unique(MDS_xy$sp.trt)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt), color = "black", pch = 21), size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}') +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_color_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I"))
animate(p, detail = 10, fps = 10)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}') +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_color_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I"))
animate(p, detail = 10, fps = 10)
animate(p, detail = 10, fps = 10, ani.width= 1000, ani.height=1000, "test.gif")
animate(p, detail = 10, fps = 10, ani.width= 1000, ani.height=1000)
animate(p, detail = 10, fps = 10, width= 1000, height=1000)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}') +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I"))
animate(p, detail = 10, fps = 10, width= 700, height=700)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I"))
animate(p, detail = 10, fps = 10, width= 700, height=700)
animate(p, detail = 10, fps = 10, width= 500, height=500)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 20, face = "bold"))
animate(p, detail = 10, fps = 10, width= 500, height=500)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
animate(p, detail = 10, fps = 10, width= 500, height=500)
animate(p, detail = 25, fps = 10, width= 750, height=500)
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: 2008') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggplot(MDS_xy %>% filter(year == 2008), aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: 2008') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggsave("../figures/nmds_viz_v2.png",
height = 500,
width = 750)
ggsave("../figures/nmds_viz_v2.png",
height = 500,
width = 750,
units = "pixels")
ggsave("../figures/nmds_viz_v2.png",
height = 500 / 300,
width = 750 / 300,
dpi = 300,
units = "in")
ggsave("../figures/nmds_viz_v2.png",
height = 5,
width = 7.5,
dpi = 300,
units = "in")
ggsave("../figures/nmds_viz_v2.png",
height = 7.5,
width = 10,
dpi = 300,
units = "in")
ggsave("../figures/nmds_viz_v2.png",
height = 7.5,
width = 11,
dpi = 300,
units = "in")
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_time(year) +
ease_aes('linear') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
animate(p, detail = 100, fps = 10, width= 750, height=500)
animate(p, detail = 100, fps = 20, width= 750, height=500)
animate(p, detail = 100, fps = 5, width= 750, height=500)
animate(p, detail = 100, fps = 10, interval = 2, width= 750, height=500)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_time(year) +
ease_aes('cubic-in-out') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
animate(p, detail = 100, fps = 10, width= 750, height=500)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_states(year) +
ease_aes('cubic-in-out') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
animate(p, detail = 100, fps = 10, width= 750, height=500)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
# labs(title = 'Year: {frame_time}', size = 4) +
transition_states(year, transition_length = 3, state_length = 1) +
ease_aes('cubic-in-out') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
animate(p, detail = 100, fps = 10, width= 750, height=500)
animate(p, detail = 400, fps = 10, width= 750, height=500)
p = ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(sp.trt)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: {frame_time}', size = 4) +
transition_time(year) +
ease_aes('cubic-in-out') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
animate(p, detail = 400, fps = 10, width= 750, height=500)
animate(p, detail = 400, fps = 10, width= 750, height=500, duration = 200)
animate(p, fps = 10, width= 750, height=500, duration = 200)
animate(p, fps = 10, width= 750, height=500, duration = 150)
animate(p, fps = 10, width= 750, height=500
)
animate(p, fps = 10, width= 750, height=500, duration = 20)
animate(p, fps = 10, width= 750, height=500, duration = 10)
animate(p, fps = 10, width= 750, height=500, duration = 15)
MDS_xy
k.cluster = pam(distmat, 4)
k.cluster$objective
MDS_xy$clust = k.cluster$clustering
ggplot(MDS_xy, aes(X1, Y, color = as.factor(clust))) +
geom_point() +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
aes(color = NULL), hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
ggtitle("NMDS colored by cluster")
cluscounts = bind_cols(ord.att, data.frame(cluster = k.cluster$clustering)) %>% group_by(year, cluster) %>% summarise(count = n()) %>% bind_rows(data.frame(year = 2008, cluster = 4, count = 0))
cols = rainbow(4, v = .75)
assign_freq = ggplot(cluscounts,
aes(x = year,
y = count / 96,
fill = factor(cluster),
shape = factor(cluster))) +
geom_line() +
geom_point(stat = "identity", size = 3) +
ggtitle("B) State Assignment Frequency") +
theme_bw() +
ylab("Frequency") +
xlab("Year") +
scale_x_continuous(breaks = seq(2008, 2018, by = 2)) +
scale_fill_manual(name = 'State Assignment',
values =c("1" = cols[1],
"2" = cols[2],
"3" = cols[3],
"4" = cols[4]),
labels = c('1. E. glaucus - S. pulchra',
'2. F. perennis - B. hordeaceous',
'3. E. caput-medusae - A. triuncialis',
'4. A. fatua - B. diandrus')) +
scale_shape_manual(name = 'State Assignment',
values =c("1" = 21,
"2" = 22,
"3" = 23,
"4" = 24),
labels = c('1. E. glaucus - S. pulchra',
'2. F. perennis - B. hordeaceous',
'3. E. caput-medusae - A. triuncialis',
'4. A. fatua - B. diandrus'))
assign_freq
ggsave("../figures/assignmentfrequency.pdf", width = 7, height = 4)
MDS_xy
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(clust)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: 2008') +
theme_void() +
scale_fill_discrete(name = "Planting Combination",
breaks = unique(MDS_xy$sp.trt),
labels = c("N", "N+A+I", "A", "N+I", "N+A", "A+I", "I")) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(clust)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: 2008') +
theme_void() +
scale_fill_manual(name = 'State Assignment',
values =c("1" = cols[1],
"2" = cols[2],
"3" = cols[3],
"4" = cols[4]),
labels = c('1. E. glaucus - S. pulchra',
'2. F. perennis - B. hordeaceous',
'3. E. caput-medusae - A. triuncialis',
'4. A. fatua - B. diandrus'))
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(clust)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: 2008') +
theme_void() +
scale_fill_manual(name = 'State Assignment',
values =c("1" = cols[1],
"2" = cols[2],
"3" = cols[3],
"4" = cols[4]),
labels = c('1. E. glaucus - S. pulchra',
'2. F. perennis - B. hordeaceous',
'3. E. caput-medusae - A. triuncialis',
'4. A. fatua - B. diandrus')) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggsave("../figures/nmds_viz_assignments.png",
height = 7.5,
width = 11,
dpi = 300,
units = "in")
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(clust)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
labs(title = 'Year: 2008') +
theme_void() +
scale_fill_manual(name = 'State Assignment',
values =c("1" = cols[1],
"2" = cols[2],
"3" = cols[3],
"4" = cols[4]),
labels = c('State 1',
'State 2',
'State 3',
'State 3')) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggsave("../figures/nmds_viz_assignments.png",
height = 7.5,
width = 11,
dpi = 300,
units = "in")
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(clust)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
# labs(title = 'Year: 2008') +
theme_void() +
scale_fill_manual(name = 'State Assignment',
values =c("1" = cols[1],
"2" = cols[2],
"3" = cols[3],
"4" = cols[4]),
labels = c('State 1',
'State 2',
'State 3',
'State 3')) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggplot(MDS_xy, aes(X1, Y)) +
geom_point(aes(fill = as.factor(clust)), color = "black", pch = 21, size = 4) +
theme_bw() +
geom_text(data = data.frame(X1 = Inf, Y = -Inf),
hjust = 1, vjust = -1,
label = paste("Stress =", round(WAPS.mds$stress, 2))) +
# labs(title = 'Year: 2008') +
theme_void() +
scale_fill_manual(name = 'State Assignment',
values =c("1" = cols[1],
"2" = cols[2],
"3" = cols[3],
"4" = cols[4]),
labels = c('State 1',
'State 2',
'State 3',
'State 3')) +
theme(plot.title = element_text(size = 24, face = "bold"),
legend.title = element_text(size = 20, face = "bold"),
legend.text = element_text(size = 20, face = "bold"))
ggsave("../figures/nmds_viz_assignments.png",
height = 7.5,
width = 11,
dpi = 300,
units = "in")
