comp.attr$sp.trt <- gsub("[[:space:]]", "", comp.attr$sp.trt)
# Binding attribute columns with abundance matrix and writing new CSV
wide.comp <- cbind(data.frame(comp.attr), data.frame(comp.wide))
# Writing full wide csv
write.csv(x = wide.comp, file = "../data/comdata_wideformat.csv")
unique(long.comp$species)
# Cleaning up WAPS data
library(dplyr);library(tidyr);library(vegan);library(testthat)
# Set working directiory
setwd("C:/Users/ebatz/Box Sync/waps/evan-sarah analyses")
# Reading in datasets
# Species composition
waps.comp <- read.csv("./data/WAPSthrough2017.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Treatment labels and group structure
trtlabels <- read.csv("./data/trtlabels.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Species labels
waps.specs <- read.csv("./data/WAPSspecies.csv",
stringsAsFactors = F)
# Gathers dataset to long format before cleaning up, creates species column
long.comp <- gather(waps.comp, key = "species", value = "cover", -c(1:7))
# Removes year labels from species column
spec <- gsub("X\\d\\d\\.*", "", long.comp$species)
# Grabs the first two digits from the species column to make a "year" column
yr <- gsub('\\.', "", long.comp$species)
yr <- gsub("X", "20", yr)
yr <- gsub("[[:alpha:]]+0?", "", yr)
# Reassigns species variable
long.comp$species <- spec
# Converts to lowercase
long.comp$species <- tolower(long.comp$species)
# Attaches year variable
long.comp <- cbind(long.comp, year = as.numeric(yr))
# Lowercase names for dataset
names(long.comp) <- c("plot", "block", "subblock",
"water", "spcomp", "fertilization",
"clipping", "species", "cover", "year")
# Assigns all NA cover values to zero
long.comp$cover[is.na(long.comp$cover)] <- 0
# Reassigns species names to standardized names in the waps.specs dataset
for(i in waps.specs$label){
long.comp$species <- gsub(paste(i, "$", sep = ""), waps.specs$specname[waps.specs$label == i], long.comp$species)
}
# Removes spaces from species names
long.comp$spcomp <- gsub("[[:space:]]\\+[[:space:]]*", " \\+", long.comp$spcomp)
# Removes whitespace from treatment names
long.comp$spcomp <- gsub("[[:space:]]", "", long.comp$spcomp)
long.comp$water <- gsub("[[:space:]]", "", long.comp$water)
# Assigns all NAs to zero, merges duplicated species names
long.comp$cover <- as.numeric(long.comp$cover)
long.comp$cover[is.na(long.comp$cover)] <- 0
long.comp <- long.comp %>% group_by(plot, block, subblock, water, fertilization, species, year) %>% summarise(cover = sum(cover))
# Writing csv of long format cover data
write.csv(x = long.comp, file = "../data/comdata_longformat.csv", sep =",")
# Spreads dataset to wide format
comp.wide <- spread(long.comp, key = "species", value = "cover")
comp.attr <- select(comp.wide, one_of(c("year", waps.specs$specname[waps.specs$type == "class"])))
comp.wide <- ungroup(comp.wide) %>%  select(one_of(waps.specs$specname[waps.specs$type != "class"]))
comp.wide <- apply(comp.wide, 2, as.numeric)
comp.wide[is.na(comp.wide)] <- 0
# Merges with treatment labels
comp.attr <- left_join(comp.attr, trtlabels)
comp.attr$sp.trt <- gsub("[[:space:]]", "", comp.attr$sp.trt)
# Binding attribute columns with abundance matrix and writing new CSV
wide.comp <- cbind(data.frame(comp.attr), data.frame(comp.wide))
# Writing full wide csv
write.csv(x = wide.comp, file = "../data/comdata_wideformat.csv")
unique(long.comp$species)
head(comp.wide)
rowSums(comp.wide)
hist(rowSums(comp.wide))
wide.comp[order(rowSums(comp.wide)),]
?order
wide.comp[order(rowSums(comp.wide), decreasing = FALSE),]
wide.comp[order(rowSums(comp.wide), decreasing = TRUE), 1:10]
wide.comp[order(rowSums(comp.wide), decreasing = TRUE)[1:10],]
wide.comp[order(rowSums(comp.wide), decreasing = TRUE)[1:10],c(1:6, 26:ncol(wide.comp))]
unique(comp.wide)
unique(c(comp.wide))
sort(unique(c(comp.wide)))
hist(c(comp.wide))
hist(na.rm(c(comp.wide)))
hist(c(comp.wide), xlim = c(1:250))
hist(c(comp.wide), xlim = c(1,250))
hist(c(comp.wide), xlim = c(2,250))
hist(c(comp.wide)[c(comp.wide) != 0])
sum(c(comp.wide) > 100)
comp.wide[comp.wide == 235]
comp.wide[comp.wide == 235] = 23.50
wide.comp[order(rowSums(comp.wide), decreasing = TRUE)[1:10],c(1:6, 26:ncol(wide.comp))]
hist(rowSums(comp.wide))
wide.comp[wide.comp == 235]
comp.wide[comp.wide == 235]
comp.wide
# Cleaning up WAPS data
library(dplyr);library(tidyr);library(vegan);library(testthat)
# Set working directiory
setwd("C:/Users/ebatz/Box Sync/waps/evan-sarah analyses")
# Reading in datasets
# Species composition
waps.comp <- read.csv("./data/WAPSthrough2017.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Treatment labels and group structure
trtlabels <- read.csv("./data/trtlabels.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Species labels
waps.specs <- read.csv("./data/WAPSspecies.csv",
stringsAsFactors = F)
# Gathers dataset to long format before cleaning up, creates species column
long.comp <- gather(waps.comp, key = "species", value = "cover", -c(1:7))
# Removes year labels from species column
spec <- gsub("X\\d\\d\\.*", "", long.comp$species)
# Grabs the first two digits from the species column to make a "year" column
yr <- gsub('\\.', "", long.comp$species)
yr <- gsub("X", "20", yr)
yr <- gsub("[[:alpha:]]+0?", "", yr)
# Reassigns species variable
long.comp$species <- spec
# Converts to lowercase
long.comp$species <- tolower(long.comp$species)
# Attaches year variable
long.comp <- cbind(long.comp, year = as.numeric(yr))
# Lowercase names for dataset
names(long.comp) <- c("plot", "block", "subblock",
"water", "spcomp", "fertilization",
"clipping", "species", "cover", "year")
# Assigns all NA cover values to zero
long.comp$cover[is.na(long.comp$cover)] <- 0
# Reassigns species names to standardized names in the waps.specs dataset
for(i in waps.specs$label){
long.comp$species <- gsub(paste(i, "$", sep = ""), waps.specs$specname[waps.specs$label == i], long.comp$species)
}
# Removes spaces from species names
long.comp$spcomp <- gsub("[[:space:]]\\+[[:space:]]*", " \\+", long.comp$spcomp)
# Removes whitespace from treatment names
long.comp$spcomp <- gsub("[[:space:]]", "", long.comp$spcomp)
long.comp$water <- gsub("[[:space:]]", "", long.comp$water)
# Assigns all NAs to zero, merges duplicated species names
long.comp$cover <- as.numeric(long.comp$cover)
long.comp$cover[is.na(long.comp$cover)] <- 0
long.comp <- long.comp %>% group_by(plot, block, subblock, water, fertilization, species, year) %>% summarise(cover = sum(cover))
# Writing csv of long format cover data
write.csv(x = long.comp, file = "../data/comdata_longformat.csv", sep =",")
# Spreads dataset to wide format
comp.wide <- spread(long.comp, key = "species", value = "cover")
comp.attr <- select(comp.wide, one_of(c("year", waps.specs$specname[waps.specs$type == "class"])))
comp.wide <- ungroup(comp.wide) %>%  select(one_of(waps.specs$specname[waps.specs$type != "class"]))
comp.wide <- apply(comp.wide, 2, as.numeric)
comp.wide[is.na(comp.wide)] <- 0
# Merges with treatment labels
comp.attr <- left_join(comp.attr, trtlabels)
comp.attr$sp.trt <- gsub("[[:space:]]", "", comp.attr$sp.trt)
# Binding attribute columns with abundance matrix and writing new CSV
wide.comp <- cbind(data.frame(comp.attr), data.frame(comp.wide))
# Writing full wide csv
write.csv(x = wide.comp, file = "../data/comdata_wideformat.csv")
unique(long.comp$species)
hist(rowSums(comp.wide))
wide.comp[order(rowSums(comp.wide), decreasing = TRUE)[1:10],c(1:6, 26:ncol(wide.comp))]
sort(unique(c(comp.wide)))
sum(c(comp.wide) > 100)
comp.wide[comp.wide == 235] = 23.50
hist(rowSums(comp.wide))
wide.comp <- cbind(data.frame(comp.attr), data.frame(comp.wide))
sum(c(comp.wide) > 100)
sort(unique(c(comp.wide)))
sum(c(comp.wide) > 100)
print(sort(unique(c(comp.wide))))
# Cover data (wide format)
cover <- read.csv("../data/comdata_wideformat.csv",
header = TRUE,
stringsAsFactors = FALSE)
group_percents = cover[,12:23]
group_percents = cover[,12:23]
cover = cover[,-(12:23)]
# Cover data (wide format)
cover <- read.csv("../data/comdata_wideformat.csv",
header = TRUE,
stringsAsFactors = FALSE)
group_percents = cover[,12:23]
cover = cover[,-(12:23)]
# Treatment labels and group structure
trtlabels <- read.csv("../data/trtlabels.csv",
header = TRUE,
stringsAsFactors = FALSE)
head(cover)
# Cover data (wide format)
cover <- read.csv("../data/comdata_wideformat.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Cover data (wide format)
cover <- read.csv("../data/comdata_wideformat.csv",
header = TRUE,
stringsAsFactors = FALSE)
group_percents = cover[,12:23]
group_percents = cover[,12:23]
cover = cover[,-(12:23)]
# Treatment labels and group structure
trtlabels <- read.csv("../data/trtlabels.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Species treatments
waps.specs <- read.csv("../data/WAPSspecies.csv",
header = TRUE,
stringsAsFactors = FALSE)
comp.attr <- select(comp.wide, one_of(c("year", waps.specs$Newval[waps.specs$Type == "class"])))
library(dplyr)
comp.attr <- select(comp.wide, one_of(c("year", waps.specs$Newval[waps.specs$Type == "class"])))
comp.attr <- select(cover, one_of(c("year", waps.specs$Newval[waps.specs$Type == "class"])))
comp.attr
comp.attr
waps.specs$type
comp.attr <- select(cover, one_of(c("year", waps.specs$specname[waps.specs$type == "class"])))
cover
comp.attr <- cover[,1:11]
comp.attr
comp.attr <- cover[1,1:11]
comp.attr
cover[1,1:12]
comp.cover <- cover[,12:ncol(cover)]
comp.cover
library(dplyr)
# Cover data (wide format)
cover <- read.csv("../data/comdata_wideformat.csv",
header = TRUE,
stringsAsFactors = FALSE)
group_percents = cover[,12:23]
cover = cover[,-(12:23)]
# Treatment labels and group structure
trtlabels <- read.csv("../data/trtlabels.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Species treatments
waps.specs <- read.csv("../data/WAPSspecies.csv",
header = TRUE,
stringsAsFactors = FALSE)
comp.attr <- cover[,1:11]
comp.cover <- cover[,12:ncol(cover)]
selected.trts <-c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
selected.clips <- c("none")
selected.fert <- c("none")
selected.water <- c("control")
ord.mat <- comp.cover[comp.attr$water == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fert %in% selected.fert,]
ord.att <- comp.attr[comp.attr$water == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fert %in% selected.fert,]
expect_true(nrow(ord.att) == nrow(ord.mat))
library(testthat)
expect_true(nrow(ord.att) == nrow(ord.mat))
# A number of rows have no recorded live plants (not s)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
ord.mat <- sqrt(ord.mat)
distmat <- vegdist(ord.mat)
library(vegan)
distmat <- vegdist(ord.mat)
ord.mat
ord.mat
ord.mat <- comp.cover[comp.attr$water == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fert %in% selected.fert,]
ord.mat
selected.trts <-c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
selected.clips <- c("none")
selected.fert <- c("none")
selected.water <- c("control")
ord.mat <- comp.cover[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fertilization %in% selected.fert,]
ord.att <- comp.attr[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fertilization %in% selected.fert,]
expect_true(nrow(ord.att) == nrow(ord.mat))
# A number of rows have no recorded live plants (not s)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
ord.mat <- sqrt(ord.mat)
library(vegan)
distmat <- vegdist(ord.mat)
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
library(ggplot2)
ggplot(MDS_xy, aes(X, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
WAPS.mds
WAPS.mds$points
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
ggplot(MDS_xy, aes(X, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
View(MDS_xy)
View(WAPS.mds$points)
ggplot(MDS_xy, aes(x1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
distmat <- vegdist(wisconsin(ord.mat))
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
library(ggplot2)
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
WAPS.mds$stress
?prc
wisconsin(ord.mat)
distmat <- vegdist(ord.mat, method = "bray")
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
WAPS.mds$stress
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
prc(ord.mat, treatment = ord.att$sp.trt, time = ord.att$year)
prc(ord.mat, treatment = ord.att$sp.trt, time = factor(ord.att$year))
prc(ord.mat, treatment = factor(ord.att$sp.trt), time = factor(ord.att$year))
pc <- prc(ord.mat, treatment = factor(ord.att$sp.trt), time = factor(ord.att$year))
plot(pc)
trt = factor(ord.att$sp.trt)
?relevel
trt
relevel(trt, "natives+WAPS+annuals")
trt <- relevel(trt, "natives+WAPS+annuals")
pc <- prc(ord.mat, treatment = trt, time = factor(ord.att$year))
plot(pc)
pc
plot(pc, axis = 1)
plot(pc, axis = 2)
plot(pc, axis = 2, select = > 100)
plot(pc, axis = 2, select = NA)
plot(pc, axis = 2, select = 0)
plot(pc, axis = 2, select = NULL)
plot(pc, axis = 2)
plot(pc, axis = 2, ylim = c(1,-2))
plot(pc, axis = 2, ylim = c(0,-.5))
plot(pc, axis = 2, ylim = c(-.5,.5))
plot(pc, axis = 2, ylim = c(-.5,1))
plot(pc, axis = 1, ylim = c(-.5,1))
plot(pc, axis = 2, ylim = c(-.5,1))
anova(pc)
plot(pc, axis = 1, ylim = c(-.5,1))
plot(pc, axis = 2, ylim = c(-.5,1))
pc <- prc(wisconsin(ord.mat), treatment = trt, time = factor(ord.att$year))
plot(pc, axis = 1, ylim = c(-.5,1))
plot(pc, axis = 2, ylim = c(-.5,1))
anova(pc)
summary(pc)
table(checklabels %>% select(one_of("H2O", "Sp.comp", "Fertilization", "Clipping")))
library(dplyr)
library(tidyr)
library(knitr)
# Cover data (wide format)
cover <- read.csv("../data/comdata_wideformat.csv",
header = TRUE,
stringsAsFactors = FALSE)
group_percents = cover[,12:23]
cover = cover[,-(12:23)]
# Treatment labels and group structure
trtlabels <- read.csv("../data/trtlabels.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Biomass data
biomass <-  read.csv("../data/biomass_all.csv",
header = TRUE,
stringsAsFactors = FALSE)
# Other treatment labels (checking for redundancy)
checklabels <- read.csv("../data/plot_ids.csv",
header = TRUE,
stringsAsFactors = FALSE)
checklabels$Sp.comp <- gsub(" ", "", checklabels$Sp.comp)
# Species treatments
waps.specs <- read.csv("../data/WAPSspecies.csv",
header = TRUE,
stringsAsFactors = FALSE)
relevant_trts = c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
checklabels = checklabels[checklabels$Sp.comp %in% relevant_trts,]
table(checklabels %>% select(one_of("H2O", "Sp.comp", "Fertilization", "Clipping")))
selected.trts <-c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
selected.clips <- c("none")
selected.fert <- c("none")
selected.water <- c("dry")
ord.mat <- comp.cover[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fertilization %in% selected.fert,]
ord.att <- comp.attr[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fertilization %in% selected.fert,]
expect_true(nrow(ord.att) == nrow(ord.mat))
# A number of rows have no recorded live plants (not s)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
ord.mat <- sqrt(ord.mat)
library(vegan)
distmat <- vegdist(ord.mat, method = "bray")
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
WAPS.mds$stress
library(ggplot2)
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
trt = factor(ord.att$sp.trt)
trt <- relevel(trt, "natives+WAPS+annuals")
pc <- prc(wisconsin(ord.mat), treatment = trt, time = factor(ord.att$year))
plot(pc, axis = 1, ylim = c(-.5,1))
plot(pc, axis = 2, ylim = c(-.5,1))
anova(pc)
selected.trts <-c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
selected.clips <- c("none")
selected.fert <- c("none")
selected.water <- c("wet")
ord.mat <- comp.cover[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fertilization %in% selected.fert,]
ord.att <- comp.attr[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fertilization %in% selected.fert,]
expect_true(nrow(ord.att) == nrow(ord.mat))
# A number of rows have no recorded live plants (not s)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
ord.mat <- sqrt(ord.mat)
library(vegan)
distmat <- vegdist(ord.mat, method = "bray")
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
WAPS.mds$stress
library(ggplot2)
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
trt = factor(ord.att$sp.trt)
trt <- relevel(trt, "natives+WAPS+annuals")
pc <- prc(wisconsin(ord.mat), treatment = trt, time = factor(ord.att$year))
plot(pc, axis = 1, ylim = c(-.5,1))
plot(pc, axis = 2, ylim = c(-.5,1))
anova(pc)
trt = factor(ord.att$sp.trt)
trt <- relevel(trt, "natives+WAPS+annuals")
pc <- prc(ord.mat, treatment = trt, time = factor(ord.att$year))
plot(pc, axis = 1, ylim = c(-.5,1))
plot(pc, axis = 2, ylim = c(-.5,1))
anova(pc)
selected.trts <-c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
selected.clips <- c("none")
selected.fert <- c("none")
selected.water <- c("wet", "latewet")
ord.mat <- comp.cover[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fertilization %in% selected.fert,]
ord.att <- comp.attr[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fertilization %in% selected.fert,]
expect_true(nrow(ord.att) == nrow(ord.mat))
# A number of rows have no recorded live plants (not s)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
ord.mat <- sqrt(ord.mat)
library(vegan)
distmat <- vegdist(ord.mat, method = "bray")
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
WAPS.mds$stress
library(ggplot2)
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
selected.trts <-c("annuals", "WAPS", "Natives", "natives+WAPS+annuals", "annuals+natives", "WAPS+annuals", "WAPS+natives")
selected.clips <- c("none")
selected.fert <- c("none")
selected.water <- c("wet")
ord.mat <- comp.cover[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips&
comp.attr$fertilization %in% selected.fert,]
ord.att <- comp.attr[comp.attr$h2o == selected.water &
comp.attr$sp.trt %in% selected.trts &
comp.attr$clip %in% selected.clips &
comp.attr$fertilization %in% selected.fert,]
expect_true(nrow(ord.att) == nrow(ord.mat))
# A number of rows have no recorded live plants (not s)
ord.att <- ord.att[rowSums(ord.mat) != 0, ]
ord.mat <- ord.mat[rowSums(ord.mat) != 0, ]
ord.mat <- sqrt(ord.mat)
library(vegan)
distmat <- vegdist(ord.mat, method = "bray")
WAPS.mds <- metaMDS(distmat, try = 5, trymax = 50, trace = F)
MDS_xy <- bind_cols(data.frame(ord.att), data.frame(X = WAPS.mds$points[,1], Y = WAPS.mds$points[,2]))
#WAPS.pca <- prcomp(ord.mat)
#PCA_xy <- cbind(data.frame(ord.att), data.frame(X = WAPS.pca$x[,1], Y = WAPS.pca$x[,2]))
WAPS.mds$stress
library(ggplot2)
ggplot(MDS_xy, aes(X1, Y, color = sp.trt)) + geom_point() + theme_bw() + facet_wrap(~year)
pc
